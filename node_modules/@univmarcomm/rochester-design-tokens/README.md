# University of Rochester - Design Tokens

Defining enterprise-level design tokens for the University of Rochester's Design System.

- [How to Install](#how-to-install)
- [How to Use](#how-to-use)
  - [PostCSS](#postcss)
  - [Sass](#sass)

## Where design tokens have been integrated

- Digital Governance Platform
- Communities of Practice web platform
- Yellowjacket - Cascade CMS web theme (SAS, Hajim, and academic departments, etc.)

## How To Install

### Authenticate with the University's Gitlab instance

For security, you have to authenticate with Gitlab before you can install any University packages. To authenticate, you will need to create an access token and run an `npm` command. You should only have to do this once per machine.

Create an access token by going to: <https://git.its.rochester.edu/-/user_settings/personal_access_tokens>

1. Click "Add new token"
2. Set name and expiration date (ex. "MacBook Pro Gitlab access" and 1 year from now)
3. Select: read_api
4. Click "Create personal access token"

Copy the access token and run this command with your token:

```bash
npm config set -- //git.its.rochester.edu/api/v4/packages/npm/:_authToken=your_token
```

### Setup registry

This will tell npm where to look when you try to install a University package. You will need to do this for each project you install a package in. (TODO: Revisit this bit, could probably be global if you add it to your root .npmrc so you don't need to run this command for every project)

```bash
echo @univmarcomm:registry=https://git.its.rochester.edu/api/v4/packages/npm/ >> .npmrc
```

### Installation

Once you have authenticated with the University's Gitlab instance and setup the registry, you should be able to install the repository and add to your project's package.json file:

```bash
npm i @univmarcomm/rochester-design-tokens
```

## How To Use

### PostCSS

#### Select a PostCSS plugin to process tokens

You will need to also install a PostCSS plugin that provides support for token implementation.

Rachel Cherry in University Marketing and Communications created a [PostCSS Design Tokens plugin](https://git.its.rochester.edu/univmarcomm/postcss-design-tokens-plugin) that supports the university's design tokens.

If you have setup authentication with the University's Gitlab instance, you should be able to install and use this package.

#### Install your PostCSS plugin

Use npm to install the plugin to your project's package.json file.

```bash
npm i @univmarcomm/postcss-design-tokens-plugin
```

#### Setup the PostCSS plugin

PostCSS requires a postcss.config file. You can [learn more about PostCSS usage in the PostCSS GitHub repo](https://github.com/postcss/postcss#usage).

Here is an example of a basic postcss.config.js file that includes the university's design tokens:

```js
import tokens from "@univmarcomm/rochester-design-tokens" assert { type: "json" };

/** @type {import('postcss-load-config').Config} */
const config = {
	plugins: {
		"postcss-design-tokens": { tokens },
		"postcss-import": {},
		"postcss-mixins": {},
		"postcss-nested": {},
	},
};

module.exports = config;
```

The PostCSS plugin adds functionality to add the tokens to your .pcss files.

#### Adding tokens to your PostCSS files

The following instructions will cover how to add design tokens using the included `token()` function.

If you are using CSS variables, you can map the tokens to your already defined variable names:

```css
:root {
	--color-rochester-blue: token(rochester.color.primary.rochesterBlue);
	--color-rochester-interactive: token(rochester.color.primary.interactiveBlue);
}
```

Or you can add the token values as CSS properties:

```css
a {
	color: token(rochester.color.primary.interactiveBlue);
}
```

The plugin also provides fallback functionality, which allows you to set values that will be provided to your CSS in case the token's value is not defined. You may not need this functionality for your setup.

Example of a fallback token:

```css
a {
	color: token(rochester.color.primary.interactiveBlue, "#283FAF");
}
```

### Sass

Import the tokens.scss file and map the tokens to convenient variable names or use them directly.

```scss
@use "path/to/node_modules/@univmarcomm/rochester-design-tokens/tokens";

// map to convenient variable names
$blue: map.get(tokens.$tokens, "rochester", "color", "primary", "interactiveBlue");

a {
	color: #{$blue};
	// or use directly
	color: map.get(tokens.$tokens, "rochester", "color", "primary", "interactiveBlue");
}
```

### Import tokens.scss

Imaginary project structure for the following code samples:

```bash
code-example/
+-- node_modules/@univmarcomm/rochester-design-tokens
+-- src/styles/styles.scss
+-- package.json
+-- public/styles/styles.css
```

```scss
@use "../../node_modules/@univmarcomm/rochester-design-tokens/tokens";
```

#### Import alternative using `--load-path`

You can shorten the import statement if you include the path to @univmarcomm/rochester-design-tokens in your build command.

##### Sass CLI

Use the `--load-path` flag to load the @univmarcomm directory to have Sass include the directory

```bash
# sass cli
sass --load-path node_modules/@univmarcomm src/styles:public/css
```

##### npm scripts

```json
{
	"name": "code-example",
	"scripts": {
		"css": "sass --load-path node_modules/@univmarcomm src/styles:public/css"
	},
	"devDependencies": {
		"sass": "^1.83.4"
	},
	"dependencies": {
		"@univmarcomm/rochester-design-tokens": "^0.2.0"
	}
}
```

```bash
# compile src sass files to public/css
npm run css
```

Both of these options will allow you to import rochester-design-tokens with an easier-to-read syntax:

```scss
@use "rochester-design-tokens/tokens";
```

### Using the Sass tokens

Once tokens.scss is imported, you use the tokens directly using the Sass `map` function.

```scss
a {
	color: map.get(tokens.$tokens, "rochester", "color", "primary", "interactiveBlue");
}
```

The syntax for pulling token values with the `map` function is clunky, so mapping the values to local variables can make things more convenient.

```scss
// map tokens to simple variable names
$blue: map.get(tokens.$tokens, "rochester", "color", "primary", "interactiveBlue");

a {
	color: #{$blue};
}
```

### Full example

```scss src/styles/styles.scss
@use "../../node_modules/@univmarcomm/rochester-design-tokens/tokens";

$blue: map.get(tokens.$tokens, "rochester", "color", "primary", "interactiveBlue");

a {
	color: #{$blue};
}
```

### JS

Todo

---

## Local development

### Important notes about the repository

**The tokens.json file cannot live in a folder with other \*.json files.** The tokens.json file is stored by itself inside the /tokens directory because, when the tokens.json file was stored in the root directory, the Figma Tokens Studio plugin would delete any other root directory sibling \*.json files, e.g. the package.json and package-lock.json files.

### Using git hooks

Run the following command to initalize the repository's git hooks:

```bash
git config core.hooksPath .githooks
```

### Building SCSS file

**Do not edit the tokens.scss file directly.** The tokens.scss file is generated automatically.

Run the following command to generate the file:

```bash
npm run compile
```

The compile command will be automatically run before each git commit.
